<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bs-primary: #3a5f87;
            --bs-secondary: #6c737a;
            --bs-success: #3e7461;
            --bs-info: #4c8aa3;
            --bs-warning: #a98c3d;
            --bs-danger: #90404e;
            --bs-light: #dee2e6;
            --bs-dark: #343a40;
            --bs-body-bg: #f5f7f9;
            --bs-border: #d1d9e0;
            --bs-card-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --bs-card-hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--bs-body-bg);
            padding-bottom: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .card {
            background-color: white;
            border: 1px solid var(--bs-border);
            border-radius: 10px;
            box-shadow: var(--bs-card-shadow);
            transition: all 0.2s ease-in-out;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--bs-card-hover-shadow);
        }

        .stat-card {
            height: 100%;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .stat-detail {
            font-size: 0.85rem;
            color: var(--bs-secondary);
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .change-positive {
            color: var(--bs-success);
        }

        .change-negative {
            color: var(--bs-danger);
        }

        .change-neutral {
            color: var(--bs-secondary);
        }

        .connection-status {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 50rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-connecting {
            background-color: var(--bs-warning);
            color: black;
        }

        .status-connected {
            background-color: var(--bs-success);
            color: white;
        }

        .status-disconnected {
            background-color: var(--bs-danger);
            color: white;
        }

        .progress {
            height: 6px;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }

        .progress-cpu {
            background-color: #e9ecef;
        }

        .progress-cpu .progress-bar {
            background-color: var(--bs-info);
        }

        .progress-ram {
            background-color: #e9ecef;
        }

        .progress-ram .progress-bar {
            background-color: var(--bs-success);
        }

        .progress-disk {
            background-color: #e9ecef;
        }

        .progress-disk .progress-bar {
            background-color: var(--bs-warning);
        }

        .worker-card {
            margin-bottom: 1rem;
        }

        .filter-btn {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 20px;
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
        }

        .section-title {
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--bs-border);
            font-weight: 600;
            color: var(--bs-dark);
        }

        /* Compact worker card styles */
        .compact-worker {
            padding: 0.75rem;
        }
        
        .compact-worker .card-title {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }
        
        .compact-worker .text-muted {
            font-size: 0.8rem;
        }
        
        .compact-worker .progress-label {
            font-size: 0.75rem;
            margin-bottom: 0.2rem;
        }
        
        .compact-worker .resource-usage {
            margin-bottom: 0.6rem;
        }
        
        .compact-worker .last-active {
            font-size: 0.75rem;
        }
        
        /* Grid adjustments for more workers */
        .worker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        /* Header improvements */
        header {
            background: linear-gradient(135deg, #4a90e2 0%, #3a5f87 50%, #2c3e50 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem !important;
        }
        
        header h1 {
            margin-bottom: 0;
            font-weight: 700;
        }
        
        header p {
            margin-bottom: 0.3rem;
        }
        
        /* Card header improvements */
        .card-header-gradient {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-bottom: 1px solid var(--bs-border);
            padding: 0.75rem 1rem;
        }
        
        /* Custom badge styles */
        .badge {
            font-size: 0.7em;
            padding: 0.35em 0.65em;
        }
        
        /* Icon styling */
        .bi {
            font-size: 1.1em;
        }
        /* Darker custom range slider */
        #rate-slider.form-range {
          accent-color: #3a5f87;
          height: 0.6rem; /* ensures consistent vertical alignment */
        }
        
        /* Chrome / Safari / Edge */
        #rate-slider.form-range::-webkit-slider-runnable-track {
          background-color: #495057;
          height: 0.6rem;
          border-radius: 10px;
        }
        
        #rate-slider.form-range::-webkit-slider-thumb {
          background-color: #3a5f87;
          border: 2px solid #fff;
          box-shadow: 0 0 5px rgba(0,0,0,0.3);
          margin-top: -6px; /* <-- centers the thumb vertically */
          height: 1.2rem;
          width: 1.2rem;
          border-radius: 50%;
        }
        
        /* Firefox */
        #rate-slider.form-range::-moz-range-track {
          background-color: #495057;
          height: 0.6rem;
          border-radius: 10px;
        }
        
        #rate-slider.form-range::-moz-range-thumb {
          background-color: #3a5f87;
          border: 2px solid #fff;
          box-shadow: 0 0 5px rgba(0,0,0,0.3);
          height: 1.2rem;
          width: 1.2rem;
          border-radius: 50%;
        }
        /* Reduce vertical space for network bars */
        .resource-usage .bar-container {
            height: 2px;        /* thinner bar */
            margin-top: 2px;    /* less space above */
            margin-bottom: 4px; /* less space below */
        }
        
        .resource-usage .bar-fill {
            height: 100%;       /* fill the thinner container */
        }

        
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
         style="backdrop-filter: blur(8px); background-color: rgba(255,255,255,0.4); z-index: 1050; display: flex;">
      <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="container-fluid py-4 px-5">
        <!-- Header Section -->
        <header class="row mb-4">
            <div class="col-md-6">
                <h1><i class="bi bi-hdd-network-fill me-2"></i> URLDrill scraper management dashboard</h1>
            </div>
            <div class="col-md-6 text-md-end">
                <p class="mb-1">Last updated: <span id="last-updated"></span></p>
                <!-- Logout Button -->
                <form action="/logout" method="post" class="d-inline">
                    <button type="submit" class="btn btn-danger btn-sm mt-2">
                        <i class="bi bi-box-arrow-right me-1"></i> Logout
                    </button>
                </form>
            </div>
        </header>
        
        <!-- Main Content -->
        <main>
            <!-- Scraping Statistics Section -->
            <section class="mb-5">
                <h2 class="section-title">Scraping Statistics</h2>
                <div class="row">
                    <!-- URL Failures Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-slash-circle-fill text-primary me-2"></i>URL Generated</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="total-url-generated"></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Size Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-database-fill text-primary me-2"></i>Data Size</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="database-size-gb"> GB</p>
                                <p class="stat-detail" id="database-size-mb"> MB</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Generated URLs -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-stopwatch-fill text-info me-2"></i>Total generated count</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="total-generated-count"> URLs</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Queue Size Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-list-check text-warning me-2"></i>Queue Size</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="queue-size"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Stats Overview Section -->
            <section class="mb-5">
                <h2 class="section-title">Stats Overview</h2>
                <div class="row">
                    <!-- Active Workers Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-cpu-fill text-success me-2"></i>Active Workers</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="percent-worker">%</p>
                                <p class="stat-detail" id="total-worker"> of  workers</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- URL Not Found Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-question-circle-fill text-danger me-2"></i>URL Not Found</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="notfound-percent">%</p>
                                <p class="stat-detail" id="notfound-of-total"> of  URLs</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scraped Pages Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-file-earmark-text-fill text-primary me-2"></i>Scraped Pages</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="scraped-pages-total"></p>
                                <p class="stat-change change-positive" id="pages-per-minute">
                                    <i class="bi bi-arrow-up"></i> 
                                     pages per minute
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Redirect Failed Card -->
                    <div class="col-md-6 col-lg-3">
                        <div class="card stat-card">
                            <div class="card-header card-header-gradient">
                                <h5 class="card-title mb-0"><i class="bi bi-sign-turn-right-fill text-warning me-2"></i>Redirect Failed</h5>
                            </div>
                            <div class="card-body">
                                <p class="stat-value" id="redirect-failed-percent">%</p>
                                <p class="stat-detail" id="redirect-failed-of-total"> of  redirects</p>
                                <p class="stat-change change-neutral">
                                    <i class="bi bi-dash"></i> No redirect rate
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Scraping Control Panel -->
            <section class="mb-5">
              <h2 class="section-title">Scraping Control Panel</h2>
              <div class="card shadow-lg border-0">
                <div class="card-header text-white" style="background: linear-gradient(90deg, #3a5f87, #2c3e50);">
                  <h5 class="card-title mb-0">
                    <i class="bi bi-sliders2-vertical me-2"></i> Controls
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row align-items-center g-4">
                    
                    <!-- Hold Controls -->

                    <div class="col-md-4 text-center">
                      <button id="queue-hold-btn" class="btn btn-warning w-75 mb-2" data-state="released">
                        <i class="bi bi-pause-circle me-2"></i> Hold Queue
                      </button>
                      <button id="worker-hold-btn" class="btn btn-danger w-75" data-state="released">
                        <i class="bi bi-pause-circle me-2"></i> Hold Workers
                      </button>
                      <div class="mx-auto mt-2" style="max-width: 220px;">
                        <small class="text-muted d-block">
                          Changes may take a few seconds to reflect after pressing a button.
                        </small>
                      </div>
                    </div>
                    
                    <!-- Adjust Rate -->
                    <div class="col-md-4">
                      <label for="rate-slider" class="form-label fw-semibold">Scraping Rate (delays)</label>
                      <div class="d-flex align-items-center mb-3">
                        <span class="badge bg-primary text-white shadow-sm px-3 py-2 fs-6" id="rate-value">0 sec/batch</span>
                      </div>
                    
                      <!-- Presets -->
                      <div class="btn-group w-100">
                        <button class="btn btn-outline-primary rate-preset" id="preset-0" data-value="50">0s/batch</button>
                        <button class="btn btn-outline-success rate-preset" id="preset-25" data-value="25">25s/batch</button>
                        <button class="btn btn-outline-danger rate-preset" id="preset-50" data-value="0">50s/batch</button>
                      </div>
                    </div>
                    
                    <!-- Admin Actions -->
                    <div class="col-md-4">
                      <label class="form-label fw-semibold text-danger">Admin Actions</label>
                      <div class="d-grid gap-2 mt-2">
                        <button id="wipe-workers" class="btn btn-danger">
                          <i class="bi bi-trash3 me-1"></i> Wipe Workers DB
                        </button>
                        <button id="revoke-keys" class="btn btn-danger">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cookie" viewBox="0 0 16 16">
                            <path d="M6 7.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m4.5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m-.5 3.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                            <path d="M8 0a7.96 7.96 0 0 0-4.075 1.114q-.245.102-.437.28A8 8 0 1 0 8 0m3.25 14.201a1.5 1.5 0 0 0-2.13.71A7 7 0 0 1 8 15a6.97 6.97 0 0 1-3.845-1.15 1.5 1.5 0 1 0-2.005-2.005A6.97 6.97 0 0 1 1 8c0-1.953.8-3.719 2.09-4.989a1.5 1.5 0 1 0 2.469-1.574A7 7 0 0 1 8 1c1.42 0 2.742.423 3.845 1.15a1.5 1.5 0 1 0 2.005 2.005A6.97 6.97 0 0 1 15 8c0 .596-.074 1.174-.214 1.727a1.5 1.5 0 1 0-1.025 2.25 7 7 0 0 1-2.51 2.224Z"/>
                          </svg> Revoke All Admin Cookies
                        </button>
                        <button id="restart-workers" class="btn btn-warning">
                          <i class="bi bi-arrow-clockwise me-1"></i> Restart All Workers
                        </button>
                        <button id="cleanup-db" class="btn btn-warning">
                          <i class="bi bi-clock-history me-1"></i> Remove all idle worker from DB
                        </button>
                      </div>
                    </div>
                    
                  </div>
                </div>
              </div>
            </section>

            
            
            <!-- Worker Nodes Section -->
            <section>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">Worker Nodes</h2>
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-primary filter-btn active">All</button>
                        <button class="btn btn-outline-primary filter-btn">Active</button>
                        <button class="btn btn-outline-primary filter-btn">Idle</button>
                    </div>
                    
                </div>
                
                <div class="worker-grid">
                    
                </div>
            </section>
        </main>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/index.js"></script>
    <script src="/static/control.js"></script>
    <script src="/static/fetch.js"></script>
</body>
</html>
